# ----------------------------
# 簡単アップデートについて
# ----------------------------

「簡単アップデート」を利用すると 10KB程度の PHP ファイルをアップロードして、ブラウザで表示させるだけで a-blog cms のパッケージのアップデートが可能です。

2.x から 3.2.x にアップデートする際に利用ください。 

# ----------------------------
# 動作環境
# ----------------------------

a-blog cms が動作している環境で利用可能です。

# ----------------------------
# 設定方法
# ----------------------------

アップデートバージョンを指定する場合は「$ablogcmsVersion」を指定ください。( 最初の # を消すと有効になります)
指定しない場合、最新バージョンにアップデートされます。

```
# $ablogcmsVersion = "3.2.0";
```

# ----------------------------
# 利用方法
# ----------------------------

1. 上記の設定を行った後に、サーバーにアップロードして、ブラウザ上からアクセスしてください。
   利用している MySQL のパスワードを入力することでシステムのファイルをアップデートします。

2. 最新のパッケージをインストール後には、メンテナンスページにログインしてください。
   その際には、管理者の ID とパスワードが必要になります。

3. ログイン後、データベースのアップデートを行ってください。

4. setup ディレクトリを削除するか、リネームすることでアップデート作業は完了です。

5. スタンダードライセンスの際には、license.php が 開発用になります。
   本番環境の場合には MYPAGE より「Ver. 3.0.0以上」のライセンスを指定してダウンロードください。

※ これまでのファイルは backup_yyyymmddhhmmss ディレクトリに移動してバックアップしておいてくれます。
  もし、途中でエラーになった際には、update.lock というファイルが作られます。再実行する際には update.lockファイルを削除してください。

# ----------------------------
# 実行できない場合
# ----------------------------
セキュリティ対策で、.htaccessで制限している可能性があります。以下のように `.htaccess` を修正して対応ください。

```
# ---------------------------------------
# index.php以外のPHPスクリプトを実行禁止
# ---------------------------------------
<FilesMatch "\.php$">
  Require all denied
</FilesMatch>
<Files "index.php">
  Require all granted
</Files>
# 以下3行を追加
<Files "update.php">
  Require all granted
</Files>
```

実行可能なスクリプト制限がコメントアウトされている場合

```
# ------------------------------------------------------------------
# 実行可能なスクリプト (PHP, CGI, Perl, Python, Shell, EXE) をブロック
# ------------------------------------------------------------------
RewriteCond %{REQUEST_URI} !^/index\.php$ [NC]
RewriteCond %{REQUEST_URI} !^/_setup/.*\.php$ [NC]
RewriteCond %{REQUEST_URI} !^/update\.php$ [NC]
# RewriteCond %{REQUEST_URI} !^/other2/index\.php$ [NC]
RewriteCond %{REQUEST_URI} \.(php|cgi|pl|py|sh|exe|bin|dll|bat|cmd|msi|jar)$ [NC]
RewriteRule ^.*$ - [F,L]
```